playState.update=function(){var e,a=this.gameInfo,t=a.turn;function i(){projectInfo.tutorial=!1,window.famobi.localStorage.setItem("showTutorial",!1),function(){a.gameCanvas.destroy(),game.device.touch&&(a.powerBarMask.visible=!1,a.powerBarCueMask.visible=!1);a.guiCanvas.destroy(),a.guiBaseCanvas.destroy(),a.cueBaseCanvas.destroy(),a.turn=t}(),projectInfo.clickedHelpButton?(window.famobi_analytics.trackEvent("EVENT_TUTORIALSKIPPED"),game.state.start("mainMenu")):(window.famobi_analytics.trackEvent("EVENT_TUTORIALCOMPLETED"),game.state.start("play"))}function n(){0==a.cueSet&&0==a.preventUpdateCue&&0==a.trial&&(a.cueSet=!0,a.cueCanvas.visible=!0,a.cueCanvas.x=a.ballArray[0].position.x*a.physScale,a.cueCanvas.y=a.ballArray[0].position.y*a.physScale,a.cue.x=-a.ballRadius*a.physScale*1.5,a.cueShadow.x=a.cue.x)}function o(){if(1==a.drawGuide){a.guideCanvas.visible=!0,a.guide.visible=!0,a.guide.lineStyle(1,16777215,.7);for(var e,t=a.ballArray[0].position.plus(a.aimDirectionVector.times(5e5)),i=new Array,n=new Array,o=!1,r=a.ballArray[0],l=1;l<a.ballArray.length;l++){var s=a.ballArray[l];if(1==s.active){var p=new Point(r.position.x,r.position.y),c=new Point(t.x,t.y),u=new Point(s.position.x,s.position.y),d=2*a.ballRadius,y=Maths.lineIntersectCircle(p,c,u,d);1==y.intersects&&(i.push(s),null!=y.enter?n.push(y.enter):(n.push(new Point(r.position.x,r.position.y)),o=!0))}}if(i.length>0){for(var m=1e11,h=0;h<i.length;h++){var v=(i[h].position.x-r.position.x)*(i[h].position.x-r.position.x)+(i[h].position.y-r.position.y)*(i[h].position.y-r.position.y);v<m&&(m=v,e=i[h],R=n[h])}a.guide.clear(),a.guide.lineStyle(1,16777215,.7);var g=Maths.findBearing(R.x-r.position.x,R.y-r.position.y),b=Maths.findBearing(e.position.x-R.x,e.position.y-R.y),f=Math.abs(Maths.angleDiff(b,g)),S=5*a.ballRadius*((90-f)/90),w=new Point(e.position.x+Math.cos(b*Math.PI/180)*S,e.position.y+Math.sin(b*Math.PI/180)*S);if(1==projectInfo.guideOn&&(a.guide.moveTo(r.position.x*a.physScale,r.position.y*a.physScale),a.guide.lineTo(R.x*a.physScale,R.y*a.physScale)),a.guide.drawCircle(R.x*a.physScale,R.y*a.physScale,2*a.ballRadius*a.physScale),1==projectInfo.guideOn&&(a.guide.moveTo(e.position.x*a.physScale,e.position.y*a.physScale),a.guide.lineTo(w.x*a.physScale,w.y*a.physScale)),0==o){var x=Maths.findBearing(R.x-r.position.x,R.y-r.position.y),P=Maths.findBearing(w.x-R.x,w.y-R.y),A=(f=Maths.angleDiff(P,x),S=5*a.ballRadius*f/90,P-90),T=new Point(R.x+S*Math.cos(A*Math.PI/180),R.y+S*Math.sin(A*Math.PI/180));1==projectInfo.guideOn&&(a.guide.moveTo(R.x*a.physScale,R.y*a.physScale),a.guide.lineTo(T.x*a.physScale,T.y*a.physScale))}}else{var I=new Array;I.push(new Point(-3e4*a.adjustmentScale+a.ballRadius,-15e3*a.adjustmentScale+a.ballRadius)),I.push(new Point(3e4*a.adjustmentScale-a.ballRadius,-15e3*a.adjustmentScale+a.ballRadius)),I.push(new Point(3e4*a.adjustmentScale-a.ballRadius,15e3*a.adjustmentScale-a.ballRadius)),I.push(new Point(-3e4*a.adjustmentScale+a.ballRadius,15e3*a.adjustmentScale-a.ballRadius)),I.push(new Point(-3e4*a.adjustmentScale+a.ballRadius,-15e3*a.adjustmentScale+a.ballRadius));var R;for(p=new Point(r.position.x,r.position.y),c=new Point(t.x,t.y),l=0;l<4;l++){null!=(n=Maths.lineIntersectLine(p,c,I[l],I[l+1]))&&(R=n)}null!=R&&(a.guide.clear(),a.guide.lineStyle(1,16777215,.7),1==projectInfo.guideOn&&(a.guide.moveTo(r.position.x*a.physScale,r.position.y*a.physScale),a.guide.lineTo(R.x*a.physScale,R.y*a.physScale)),a.guide.drawCircle(R.x*a.physScale,R.y*a.physScale,2*a.ballRadius*a.physScale))}}}function r(){if(Sound.Play("cueHit",1),a.ballArray[0].mover.visible=!1,a.shotRunning=!0,a.shotNum++,a.ballArray[0].velocity=a.aimDirectionVector.times(a.power),a.shotReset=!1,0==a.timerStarted){a.timerStarted=!0,startTimer();var e=game.add.tween(a.levelText);e.to({alpha:0},1e3,Phaser.Easing.Linear.None,2e3),e.onComplete.add((function(){a.levelText.visible=!1}),this)}}function l(){if(1==a.cueTweenComplete||1==a.trial){for(var e=!0,t=0;t<a.ballArray.length;t++)0==a.ballArray[t].pocketTweenComplete&&(e=!1);if(1==e||1==a.trial){for(var i=!1,n=0;n<a.ballArray.length;n++){a.ballArray[n].velocity.magnitude>0&&(i=!0)}0==i&&(a.shotRunning=!1,a.shotComplete=!0)}}}function s(){1==a.shotComplete&&0==a.rulingsApplied&&0==a.shotRunning&&(preventQuit=!0,a.rulingsApplied=!0,function(){for(var e=!0,t=a.ballArray[0],i=0;i<t.contactArray.length;i++){if("ball"==t.contactArray[i].collisionType){e=!1;break}}if(1==e){var n;a.foulMessage="missed the balls",a.fouled=!0,a.foulDisplay1="MISS",n="p2"==a.turn?a.p2TargetType:a.p1TargetType,a.foulDisplay2=n}}(),function(){for(var e=0;e<a.ballArray[0].contactArray.length;e++){var t=a.ballArray[0].contactArray[e];if("ball"==t.type){var i,n=t.target.id;"ANY"!=(i="p1"==a.turn?a.p1TargetType:a.p2TargetType)&&"SOLIDS"!=i&&"STRIPES"!=i||8==n&&(a.fouled=!0,a.foulMessage="struck the wrong ball first",a.foulDisplay1="8 BALL",a.foulDisplay2=i),"SOLIDS"==i&&n>7&&(a.fouled=!0,a.foulMessage="struck the wrong ball first",a.foulDisplay1=8==n?"8 BALL":"STRIPES",a.foulDisplay2="SOLIDS"),"STRIPES"==i&&n<9&&(a.fouled=!0,a.foulMessage="struck the wrong ball first",a.foulDisplay1=8==n?"8 BALL":"SOLIDS",a.foulDisplay2="STRIPES"),"8 BALL"==i&&8!=n&&(a.fouled=!0,a.foulMessage="struck the wrong ball first",a.foulDisplay1=n<8?"SOLIDS":"STRIPES",a.foulDisplay2="8 BALL");break}}}(),1==a.scratched&&(a.fouled=!0,a.foulMessage="potted the cue ball",a.foulDisplay3="POTTEDCUEBALL","practice"==a.mode&&(a.cueBallInHand=!0)),function(){var e,t;a.ballsPottedSameType=!0;for(var i=1;i<a.ballArray.length;i++)for(var n=a.ballArray[i],o=0;o<n.contactArray.length;o++){var r;if("pocket"==n.contactArray[o].type)a.trial,a.ballsPotted++,r="p2"==a.turn?a.p2TargetType:a.p1TargetType,8==n.id&&"practice"!=a.mode&&("8 BALL"==r&&(1==a.trial?a.shotRating=1:(a.gameOver=!0,a.winner=a.turn)),"8 BALL"==r&&1!=a.fouled||(1==a.trial?a.shotRating=-1.5:(a.gameOver=!0,a.foulDisplay3="POTTED8BALL","p2"==a.turn?a.winner="p1":a.winner="p2"))),0==a.fouled&&8!=n.id&&(1==a.ballsPotted&&(n.id>8&&(e="STRIPES"),n.id<8&&(e="SOLIDS"),a.typesPotted=e),a.ballsPotted>1&&(n.id>8&&(t="STRIPES"),n.id<8&&(t="SOLIDS"),t!=e&&(a.ballsPottedSameType=!1,a.typesPotted="")),("STRIPES"==r&&n.id>8||"SOLIDS"==r&&n.id<8||"ANY"==r&&8!=n.id)&&(1==a.trial&&(a.shotRating+=.1),0==a.trial&&(a.turnExtended=!0)))}0==a.ballsPotted&&0==a.trial&&(a.ballsPottedSameType=!1,a.typesPotted="")}(),function(){if(0==a.ballsPotted&&0==a.fouled)if(1==a.shotNum){for(var e=!1,t=0,i=1;i<a.ballArray.length;i++){var n=a.ballArray[i],o=!1;if(1==n.active)for(var r=0;r<n.contactArray.length;r++){var l=n.contactArray[r];if("line"==l.type||"vertex"==l.type){o=!0;break}}1==o&&t++}t<2&&(a.fouled=!0,a.foulMessage=" failed to make 2 balls hit the cushions on the break",a.foulDisplay4="CUSHIONONBREAK")}else{for(var s=!1,p=(e=!1,0);p<a.ballArray.length;p++){var c=a.ballArray[p];if(1==c.active){for(var u=0;u<c.contactArray.length;u++){var d=c.contactArray[u];if(0==p&&"ball"==d.type&&(e=!0),(1==e||p>0)&&("line"==d.type||"vertex"==d.type)){s=!0;break}}if(1==s)break}}0==s&&(a.fouled=!0,a.foulMessage=" failed to make a ball hit a cushion after the first contact with the cue ball",a.foulDisplay3="CUSHION")}}(),"practice"!=a.mode&&(1==a.fouled?0==a.trial?(a.cueBallInHand=!0,1==a.shotNum&&(gameRunning=!1,a.rerack=!0),function(){if("potted the cue ball"!=a.foulMessage||0==a.scratchFoulShown){function e(){if(1==a.foulWindow.visible){var e=game.add.tween(a.foulWindow);e.to({alpha:0},1e3,"Linear",!0),e.onComplete.add(t,this)}function t(){1==a.foulWindow.visible&&(a.foulWindow.visible=!1,a.foulDisplayComplete=!0,0==a.rerack&&(a.gameRunning=!0),p())}}switch(a.gameRunning=!1,"potted the cue ball"==a.foulMessage&&(a.scratchFoulShown=!0),a.foulDisplayComplete=!1,a.turn,a.foulWindow.visible=!0,a.foulWindow.alpha=0,game.add.tween(a.foulWindow).to({alpha:1},1e3,"Linear",!0),game.time.events.add(4*Phaser.Timer.SECOND,e,this),a.foulWindow.display1.visible=!1,a.foulWindow.display2.visible=!1,a.foulWindow.display3.visible=!1,a.foulWindow.display4.visible=!1,a.foulDisplay1){case"8 BALL":a.foulWindow.display1.visible=!0,a.foulWindow.display1.frame=0;break;case"MISS":a.foulWindow.display1.visible=!0,a.foulWindow.display1.frame=1;break;case"SOLIDS":a.foulWindow.display1.visible=!0,a.foulWindow.display1.frame=2;break;case"STRIPES":a.foulWindow.display1.visible=!0,a.foulWindow.display1.frame=3;break}switch(a.foulDisplay2){case"8 BALL":a.foulWindow.display2.visible=!0,a.foulWindow.display2.frame=0;break;case"SOLIDS":a.foulWindow.display2.visible=!0,a.foulWindow.display2.frame=2;break;case"ANY":a.foulWindow.display2.visible=!0,a.foulWindow.display2.frame=2;break;case"STRIPES":a.foulWindow.display2.visible=!0,a.foulWindow.display2.frame=3;break}switch(a.foulDisplay3){case"CUSHION":a.foulWindow.display1.visible=!1,a.foulWindow.display2.visible=!1,a.foulWindow.display3.visible=!0,a.foulWindow.display3.frame=0;break;case"POTTED8BALL":a.foulWindow.display1.visible=!1,a.foulWindow.display2.visible=!1,a.foulWindow.display3.visible=!0,a.foulWindow.display3.frame=1;break;case"POTTEDCUEBALL":a.foulWindow.display1.visible=!1,a.foulWindow.display2.visible=!1,a.foulWindow.display3.visible=!0,a.foulWindow.display3.frame=2;break}switch(a.foulDisplay4){case"CUSHIONONBREAK":a.foulWindow.display4.visible=!0;break}}else p()}()):(a.shotRating=-1,p()):(0==a.trial&&(a.cueBallInHand=!1,projectInfo.lastBreaker="none",a.rerack=!1),a.fouled||"p1"==a.turn&&famobi_analytics.trackEvent("EVENT_LIVESCORE",{liveScore:projectInfo.score}),p())))}function p(){if(1==a.gameRunning){if("practice"==a.mode){for(var e=!1,t=1;t<a.ballArray.length;t++)1==a.ballArray[t].active&&(e=!0);0==e&&(a.gameOver=!0)}0==a.gameOver&&(0==a.trial&&"practice"!=a.mode&&(!function(){var e;e="p2"==a.turn?a.p2TargetType:a.p1TargetType;if("ANY"==e&&a.shotNum>1&&1==a.ballsPottedSameType&&a.ballsPotted>0&&0==a.fouled){"p2"==a.turn?(a.p2TargetType=a.typesPotted,"STRIPES"==a.p2TargetType?a.p1TargetType="SOLIDS":a.p1TargetType="STRIPES"):(a.p1TargetType=a.typesPotted,"STRIPES"==a.p1TargetType?a.p2TargetType="SOLIDS":a.p2TargetType="STRIPES"),"SOLIDS"==a.p1TargetType&&(1==a.landscape?(a.rackSolids.x=game.width/4,a.rackStripes.x=3*game.width/4):(a.rackStripes.y=game.height-10,a.rackSolids.y=game.height-95),a.p1Rack="solids",a.p2Rack="stripes"),"STRIPES"==a.p1TargetType&&(1==a.landscape?(a.rackSolids.x=3*game.width/4,a.rackStripes.x=game.width/4):(a.rackSolids.y=game.height-10,a.rackStripes.y=game.height-100),a.p2Rack="solids",a.p1Rack="stripes");for(var t=0;t<7;t++)a.rackSolidsArray[t].visible=!0,a.rackStripesArray[t].visible=!0}var i=0,n=0;for(t=1;t<a.ballArray.length;t++){var o=a.ballArray[t];1==o.active&&(o.id<8&&n++,o.id>8&&i++)}"STRIPES"!=a.p2TargetType&&"ANY"!=a.p2TargetType||0==i&&(a.p2TargetType="8 BALL");"SOLIDS"!=a.p2TargetType&&"ANY"!=a.p2TargetType||0==n&&(a.p2TargetType="8 BALL");"STRIPES"!=a.p1TargetType&&"ANY"!=a.p1TargetType||0==i&&(a.p1TargetType="8 BALL");"SOLIDS"!=a.p1TargetType&&"ANY"!=a.p1TargetType||0==n&&(a.p1TargetType="8 BALL");!function(){for(var e=playState.gameInfo,a=0;a<e.pottedBallArray.length;a++){var t=e.pottedBallArray[a];e.rackSpotNumberArray[t].visible=!1}"8 BALL"==e.p1TargetType&&("solids"==e.p1Rack?e.rackSolids8ball.visible=!0:e.rackStripes8ball.visible=!0);"8 BALL"==e.p2TargetType&&("solids"==e.p2Rack?e.rackSolids8ball.visible=!0:e.rackStripes8ball.visible=!0)}()}(),0!=a.turnExtended&&1!=a.fouled||("p2"==a.turn?(a.turn="p1",a.turnArrow1.frame=1,a.turnArrow2.frame=0):(a.turn="p2",a.turnArrow1.frame=0,a.turnArrow2.frame=1))),v())}preventQuit=!1,1==a.rerack&&(preventQuit=!0,game.time.events.add(500,h,this))}function c(e=!1){if(e&&(a.winner="p1"),window.famobi_analytics.trackScreen("SCREEN_LEVELRESULT"),a.gameOverPanel.visible=!0,"p1"==a.winner&&1==projectInfo.mode&&(a.playerWin.visible=!0),"p2"==a.winner&&1==projectInfo.mode&&(a.aiWin.visible=!0,projectInfo.score=0),2==projectInfo.mode){a.p1Icon.visible=!0,a.p2Icon.visible=!0;let e=-100;"p1"==a.winner?(a.p2Icon.rosette.visible=!1,a.p2Icon.scale=new Phaser.Point(.4,.4),a.p2Icon.y=e+12.8,a.p1Icon.y=e):(a.p1Icon.rosette.visible=!1,a.p1Icon.scale=new Phaser.Point(.4,.4),a.p2Icon.y=e,a.p1Icon.y=e+12.8),a.gameOverWindow.visible=!1,a.GOscoreIcon.visible=!1,a.GOhighScoreIcon.visible=!1,a.gameOverPanel.text1.visible=!1,a.gameOverPanel.text2.visible=!1}if(a.gameOverPanel.text1.text=String(projectInfo.score),a.gameOverPanel.text2.text=String(projectInfo.bestScore),a.GOaiLevel.visible=!1,a.GOclockIcon.visible=!1,a.gameOverPanel.text3.visible=!1,a.gameOverPanel.text4.visible=!1,"p1"==a.winner&&1==projectInfo.mode)a.quitButton2.visible=!1,a.replayButton.visible=!1,function(){Sound.Play("cheer",1),game.time.events.add(2e3,u,this)}();else{a.quitButton2.visible=!1,a.replayButton.visible=!1;var t=function(){a.quitButton2.visible=!0,a.replayButton.visible=!0,a.quitButton2.input.enabled=!0,a.replayButton.input.enabled=!0};game.time.events.add(2e3,(function(){m().then(t,t)}),this)}}function u(){a.GOclockIcon.visible=!0;var e=180-Math.round(a.time/60);e<0&&(e=0),a.gameOverPanel.text3.text=String(e),a.gameOverPanel.text3.visible=!0,projectInfo.score+=e,e>0?(a.allowTransferPoints=!0,a.transfer1Complete=!1):game.time.events.add(2e3,d,this)}function d(){a.GOaiLevel.visible=!0,a.GOaiLevel.frame=projectInfo.aiRating-1,a.gameOverPanel.text4.visible=!0;var e=100*projectInfo.aiRating;a.gameOverPanel.text4.text=String(e),projectInfo.score+=e,a.allowTransferPoints=!0,a.transfer2Complete=!1,game.time.events.add(2e3,(function(){m().then(y,y)}))}function y(){a.quitButton2.visible=!0,a.replayButton.visible=!0,a.quitButton2.input.enabled=!0,a.replayButton.input.enabled=!0}function m(){if("p1"==a.winner&&1==projectInfo.mode&&projectInfo.score>projectInfo.bestScore){projectInfo.bestScore=projectInfo.score;try{window.famobi.localStorage.setItem("bestScore",projectInfo.bestScore)}catch(e){}}if(a.time<projectInfo.bestTime||0==projectInfo.bestTime){projectInfo.bestTime=a.time;try{window.famobi.localStorage.setItem("bestTime",projectInfo.bestTime)}catch(e){}}projectInfo.numGames++;try{window.famobi.localStorage.setItem("numGames",projectInfo.numGames)}catch(e){}var e=[];return 1==projectInfo.mode&&"p2"==a.winner&&e.push(window.famobi_analytics.trackEvent(famobi_analytics.EVENT_LEVELFAIL,{levelName:projectInfo.levelName,reason:"dead"})),1==projectInfo.mode&&"p1"==a.winner&&e.push(window.famobi_analytics.trackEvent(famobi_analytics.EVENT_LEVELSUCCESS,{levelName:projectInfo.levelName})),2==projectInfo.mode&&e.push(window.famobi_analytics.trackEvent(famobi_analytics.EVENT_LEVELSUCCESS,{levelName:"2_player_mode"})),1==projectInfo.mode&&"p1"==a.winner&&e.push(window.famobi_analytics.trackEvent(famobi_analytics.EVENT_TOTALSCORE,{levelName:"",totalScore:projectInfo.score})),Promise.all(e)}function h(){projectInfo.lastBreaker=a.turn,game.state.start("play")}function v(){game.device.touch&&(a.powerBarMask.x=0,a.powerBarMask.y=0),a.cueSet=!1,a.lockAim=!1,a.executeStrike=!1,a.settingPower=!1,a.beginStrike=!1,a.cueTweenComplete=!1,0!=a.ballPotted&&1!=a.fouled||(a.multiplier=1,a.multiplierText.text="x"+a.multiplier),a.ballPotted=!1,a.fouled=!1,a.firstTouch=!1,a.rulingsApplied=!1,a.ballsPotted=0,a.turnExtended=!1,a.ballsPottedSameType=!1,a.typesPotted="",a.scratched=!1,a.settingPower=!1,0==a.trial&&(a.foundCalculatedShots=!1,a.foundRandomShots=!1);for(var e=0;e<a.ballArray.length;e++)a.ballArray[e].lastCollisionObject=null,a.ballArray[e].firstContact=!1,a.ballArray[e].contactArray=new Array;if("p1"==a.turn||2==projectInfo.mode){if(a.ballArray[0].mc.visible=!0,1==a.cueBallInHand&&(a.ballArray[0].active=!0,a.ballArray[0].shadow.visible=!0,a.ballArray[0].mc.visible=!0,renderScreen()),a.shotNum>0&&0==a.rerack){for(var t=1;t<a.ballArray.length;t++){1==(i=a.ballArray[t]).active&&("p1"==a.turn?(i.targetType==a.p1TargetType||"ANY"==a.p1TargetType&&"8 BALL"!=i.targetType)&&(i.marker.visible=!0,i.marker.alpha=0,i.marker.x=i.mc.x,i.marker.y=i.mc.y):(i.targetType==a.p2TargetType||"ANY"==a.p2TargetType&&"8 BALL"!=i.targetType)&&(i.marker.visible=!0,i.marker.alpha=0,i.marker.x=i.mc.x,i.marker.y=i.mc.y))}!function(){a.markerRepeat&&game.time.events.remove(a.markerRepeat);function e(){for(var t=1;t<a.ballArray.length;t++){var i=a.ballArray[t];i.marker.alpha=1,i.marker.animations.stop(1),i.marker.animations.play("markerAnim",40,!1)}a.markerRepeat=game.time.events.add(5*Phaser.Timer.SECOND,e,this)}game.time.events.add(1.5*Phaser.Timer.SECOND,e,this)}()}}else 1==a.cueBallInHand&&(a.ballArray[0].active=!0,a.ballArray[0].shadow.visible=!0,a.ballArray[0].mc.visible=!0);if("p2"==a.turn&&1==projectInfo.mode)for(t=1;t<a.ballArray.length;t++){var i;(i=a.ballArray[t]).marker.visible=!1,i.marker.x=i.mc.x,i.marker.y=i.mc.y}if("p2"==a.turn&&1==projectInfo.mode&&(a.power=4e3,a.cueBallInHand),("p1"==a.turn||2==projectInfo.mode)&&game.device.touch&&0==a.cueBallInHand){n();var r=Maths.findBearing(-a.cueCanvas.x,-a.cueCanvas.y);a.cueCanvas.angle=r,a.drawGuide=!0;var l=Math.cos(a.cueCanvas.angle*Math.PI/180),s=Math.sin(a.cueCanvas.angle*Math.PI/180);a.aimDirectionVector=new Vector2D(l,s).normalize(),o()}0==a.rerack&&(a.shotReset=!0),a.cueBallSpot.x=0,a.cueBallSpot.y=0,a.cueBallSpotZoom.x=0,a.cueBallSpotZoom.y=0,a.ballArray[0].spin=0,a.ballArray[0].english=0,a.foulDisplay1="NONE",a.foulDisplay2="NONE",a.foulDisplay3="NONE",a.foulDisplay4="NONE",a.placedInCenter=!1,a.preventAim=!1,a.preventSetPower=!1,a.preventUpdateCue=!1,a.drawGuide=!0,a.moverMouseDown=!1}function g(e,t){for(var i=!1,n=1;n<a.ballArray.length;n++){var o=a.ballArray[n];if(1==o.active)if((o.position.x-e)*(o.position.x-e)+(o.position.y-t)*(o.position.y-t)<2*a.ballRadius*a.ballRadius*2+10){i=!0;break}}return i}function b(e,t){for(var i=!1,n=1;n<a.ballArray.length;n++){var o=a.ballArray[n];if(1==o.active)if((o.position.x-e)*(o.position.x-e)+(o.position.y-t)*(o.position.y-t)<2*a.ballRadius*a.ballRadius*2-10){i=!0;break}}return i}function f(e,t){for(var i=!0,n=new Point(e.position.x,e.position.y),o=new Point(t.position.x,t.position.y),r=2*a.ballRadius,l=1;l<a.ballArray.length;l++){var s=a.ballArray[l];if(1==s.active&&s!=e&&s!=t){var p=new Point(s.position.x,s.position.y),c=Maths.lineIntersectCircle(n,o,p,r);if(1==c.intersects&&0==c.tangent){i=!1;break}}}return i}function S(e,t){for(var i=!0,n=2*a.ballRadius,o=1;o<a.ballArray.length;o++){var r=a.ballArray[o];if(1==r.active){var l=new Point(r.position.x,r.position.y),s=Maths.lineIntersectCircle(e,t,l,n);if(1==s.intersects&&0==s.tangent){i=!1;break}}}return i}function w(){if(0==a.foundRandomShots){a.foundRandomShots=!0,a.testNumber=0,a.shotTrialArray=new Array,a.bestShot=-2;for(var e=Math.round(10*projectInfo.aiRating),t=0;t<e;t++){var i=360*Math.random(),n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),r=new Vector2D(n,o).normalize(),l=500+1500*Math.random(),s=r.times(l);a.shotTrialArray.push(s)}}}function x(e,t,i,n){if("p2"==a.turn&&(a.shotNum++,a.shotReset=!1,a.rulingsApplied=!1,a.shotRunning=!0,a.ballArray[0].screw=i,a.ballArray[0].english=n,a.ballArray[0].velocity=new Vector2D(e,t),a.ballArray[0].ySpin=-a.ballArray[0].english*a.ballArray[0].velocity.magnitude/300,a.ballArray[0].ySpin>20&&(a.ballArray[0].ySpin=20),a.ballArray[0].ySpin<-20&&(a.ballArray[0].ySpin=-20),0==a.trial)){var o=a.ballArray[0].velocity.magnitude/6e3;o>1&&(o=1),o<.3&&(o=.3),Sound.Play("cueHit",o),game.add.tween(a.cue).to({x:a.power/600},500,Phaser.Easing.Linear.easeOut,!0),game.add.tween(a.cueShadow).to({x:a.power/600},500,Phaser.Easing.Linear.easeOut,!0);var r=game.add.tween(a.cueCanvas);r.to({alpha:0},1e3,"Linear",!0,1500),r.onComplete.add((function(){a.cueCanvas.visible=!1,a.cueCanvas.alpha=1,a.cueTweenComplete=!0}),this),a.cueTweenComplete=!1}}1==a.gameRunning&&(0==a.shotRunning&&1==a.shotReset&&(0==a.initVars&&(v(),a.initVars=!0),"p1"!=a.turn&&2!=projectInfo.mode||(e=game.input.activePointer,a.cursorLocal=new Point(e.x-a.gameCanvas.x,e.y-a.gameCanvas.y),a.landscape||(a.cursorLocal=new Point(-a.cursorLocal.y,a.cursorLocal.x)),0==projectInfo.tutorial&&(function(){if(1==a.cueBallInHand&&0==a.shotRunning&&0==a.settingPower){var e=a.ballArray[0];if(e.mover.visible=!0,a.shotNum>0&&0==a.placedInCenter){a.placedInCenter=!0,e.mc.visible=!0,e.shadow.visible=!0,e.position.x=0,e.position.y=0,e.mc.x=0,e.mc.y=0,e.active=!0;var t=!1,i=0;do{i++,0==g(e.position.x,e.position.y)?t=!0:e.x-=a.ballRadius}while(i<500&&0==t);renderScreen()}function n(){a.moverMouseDown=!0}function r(){a.moverMouseDown=!1}function l(){a.moverMouseOver=!0}function s(){a.moverMouseOver=!1}if(e.mover.events.onInputDown.add(n,this),e.mover.events.onInputUp.add(r,this),e.mover.events.onInputOver.add(l,this),e.mover.events.onInputOut.add(s,this),1==a.moverMouseOver&&(a.placeFirstTimeMouseUp=!0,a.cueCanvas.visible=!1,a.guideCanvas.visible=!1,a.guide.visible=!1,a.preventAim=!0,a.preventSetPower=!0,a.preventUpdateCue=!0,a.drawGuide=!1),1==a.moverMouseDown)a.placeFirstTimeMouseUp=!0,game.add.tween(e.mover).to({alpha:1},500,"Linear",!0),a.cueCanvas.visible=!1,a.guideCanvas.visible=!1,a.preventAim=!0,a.preventSetPower=!0,a.preventUpdateCue=!0,a.drawGuide=!1,e.mc.visible=!0,!function(e){for(var t,i=a.ballArray[0],n=new Array,o=new Array,r=1;r<a.ballArray.length;r++){var l=a.ballArray[r];if(1==l.active){var s=new Point(i.position.x,i.position.y),p=new Point(e.x,e.y),c=new Point(l.position.x,l.position.y),u=2*a.ballRadius,d=Maths.lineIntersectCircle(s,p,c,u);1==d.intersects&&(n.push(l),null!=d.enter?o.push(d.enter):null!=d.exit?o.push(d.exit):(o.push(new Point(i.position.x,i.position.y)),!0))}}if(1==n.length){t=n[0],L=o[0];var y=new Vector2D(t.position.x,t.position.y),m=new Vector2D(L.x,L.y),h=y.minus(m).normalize(),v=m.minus(h.times(200));i.position=v}if(n.length>1){for(var g=new Array,f=0;f<n.length;f++)for(var S=f;S<n.length;S++)if(f!=S){var w=n[f],x=n[S],P=Maths.circleIntersectCircle(w.position.x,w.position.y,2*a.ballRadius,x.position.x,x.position.y,2*a.ballRadius);if(null!=P){var A=new Point(P.x3,P.y3),T=new Point(P.x4,P.y4);g.push(A),g.push(T)}}var I,R=1e14;if(g.length>0)for(var C=0;C<g.length;C++)if(0==b(g[C].x,g[C].y)){var k=(g[C].x-e.x)*(g[C].x-e.x)+(g[C].y-e.y)*(g[C].y-e.y);k<R&&(R=k,I=g[C])}if(I){m=new Vector2D(I.x,I.y),h=e.minus(m).normalize(),v=m.minus(h.times(100));i.position=v}}if(0==n.length){var L,M=new Array;p=new Point(e.x,e.y);a.shotNum>0?(s=new Point(0,0),M.push(new Point(-3e4*a.adjustmentScale+a.ballRadius+10,-15e3*a.adjustmentScale+a.ballRadius+10)),M.push(new Point(3e4*a.adjustmentScale-a.ballRadius-10,-15e3*a.adjustmentScale+a.ballRadius+10)),M.push(new Point(3e4*a.adjustmentScale-a.ballRadius-10,15e3*a.adjustmentScale-a.ballRadius-10)),M.push(new Point(-3e4*a.adjustmentScale+a.ballRadius+10,15e3*a.adjustmentScale-a.ballRadius-10)),M.push(new Point(-3e4*a.adjustmentScale+a.ballRadius+10,-15e3*a.adjustmentScale+a.ballRadius+10))):(s=new Point(-22500*a.adjustmentScale,0),M.push(new Point(-3e4*a.adjustmentScale+a.ballRadius+10,-15e3*a.adjustmentScale+a.ballRadius+10)),M.push(new Point(-15e3*a.adjustmentScale+10,-15e3*a.adjustmentScale+a.ballRadius+10)),M.push(new Point(-15e3*a.adjustmentScale+10,15e3*a.adjustmentScale-a.ballRadius-10)),M.push(new Point(-3e4*a.adjustmentScale+a.ballRadius+10,15e3*a.adjustmentScale-a.ballRadius-10)),M.push(new Point(-3e4*a.adjustmentScale+a.ballRadius+10,-15e3*a.adjustmentScale+a.ballRadius+10)));for(r=0;r<4;r++){null!=(o=Maths.lineIntersectLine(s,p,M[r],M[r+1]))&&(L=o)}if(null!=L){var j=new Vector2D(i.position.x,i.position.y);m=new Vector2D(L.x,L.y),h=e.minus(j).normalize();i.position=m.minus(h.times(100))}else i.position.x=e.x,i.position.y=e.y}for(;1==b(i.position.x,i.position.y);)i.position.x-=a.ballRadius/4;!function(){var e=a.ballArray[0].position,t=!1;e.x>-3e4*a.adjustmentScale+a.ballRadius&&e.x<3e4*a.adjustmentScale-a.ballRadius&&e.y>-15e3*a.adjustmentScale+a.ballRadius&&e.y<15e3*a.adjustmentScale-a.ballRadius&&(t=!0);if(!t){var i;for(e.x<-3e4*a.adjustmentScale+a.ballRadius+5&&(e.x=-3e4*a.adjustmentScale+a.ballRadius+5,i="left"),e.x>3e4*a.adjustmentScale-a.ballRadius-5&&(e.x=3e4*a.adjustmentScale-a.ballRadius-5,i="right"),e.y<-15e3*a.adjustmentScale+a.ballRadius+5&&(e.y=-15e3*a.adjustmentScale+a.ballRadius+5,i="top"),e.y>15e3*a.adjustmentScale-a.ballRadius-5&&(e.y=15e3*a.adjustmentScale-a.ballRadius-5,i="bottom");1==b(e.x,e.y);)"left"==i&&(e.y-=a.ballRadius/4,e.y<-15e3*a.adjustmentScale+a.ballRadius+5&&(e.y=-15e3*a.adjustmentScale+a.ballRadius+5,i="top")),"top"==i&&(e.x+=a.ballRadius/4,e.x>3e4*a.adjustmentScale-a.ballRadius-5&&(e.x=3e4*a.adjustmentScale-a.ballRadius-5,i="right")),"right"==i&&(e.y+=a.ballRadius/4,e.y>15e3*a.adjustmentScale-a.ballRadius-5&&(e.y=15e3*a.adjustmentScale-a.ballRadius-5,i="bottom")),"bottom"==i&&(e.x-=a.ballRadius/4,e.x<-3e4*a.adjustmentScale+a.ballRadius+5&&(e.x=-3e4*a.adjustmentScale+a.ballRadius+5,i="left"))}}()}(new Vector2D(a.cursorLocal.x/a.physScale,a.cursorLocal.y/a.physScale)),a.cueSet=!1,renderScreen();if(game.device.touch&&0==a.moverMouseDown&&(a.moverMouseOver=!1),0==a.moverMouseDown&&0==a.moverMouseOver&&1==a.placeFirstTimeMouseUp){a.preventAim=!1,a.preventSetPower=!1,a.cueCanvas.visible=!0,a.placeFirstTimeMouseUp=!1,a.cueCanvas.x=a.ballArray[0].position.x*a.physScale,a.cueCanvas.y=a.ballArray[0].position.y*a.physScale;var p=Maths.findBearing(-a.cueCanvas.x,-a.cueCanvas.y);a.cueCanvas.angle=p;var c=Math.cos(a.cueCanvas.angle*Math.PI/180),u=Math.sin(a.cueCanvas.angle*Math.PI/180);a.aimDirectionVector=new Vector2D(c,u).normalize(),a.preventUpdateCue=!1,a.drawGuide=!0,o(),game.add.tween(e.mover).to({alpha:.2},500,"Linear",!0)}}}(),function(){if((0==a.startAim||!game.device.touch)&&(1==a.spinSetterZoom.visible&&0==a.settingSpin&&game.input.activePointer.isDown&&(game.input.activePointer.x>a.spinSetterZoom.x+a.spinSetterZoom.width/2||game.input.activePointer.x<a.spinSetterZoom.x-a.spinSetterZoom.width/2||game.input.activePointer.y>a.spinSetterZoom.y+a.spinSetterZoom.height/2||game.input.activePointer.y<a.spinSetterZoom.y-a.spinSetterZoom.height/2)&&(a.spinSetterZoom.visible=!1,a.preventAim=!1,a.preventSetPower=!1),1==a.settingSpin&&0==game.input.activePointer.isDown&&(a.settingSpin=!1),0==a.settingPower&&0==a.shotRunning&&a.spinSetter.input.checkPointerDown(game.input.activePointer)&&0==a.spinSetterZoom.visible&&(a.spinSetterZoom.visible=!0,a.preventAim=!0,a.preventSetPower=!0),a.spinSetterZoom.input.checkPointerDown(game.input.activePointer)&&1==a.spinSetterZoom.visible)){if(a.settingSpin=!0,a.cueBallSpotZoom.x=game.input.x-a.spinSetterZoom.x,a.cueBallSpotZoom.y=game.input.y-a.spinSetterZoom.y,a.cueBallSpotZoom.x*a.cueBallSpotZoom.x+a.cueBallSpotZoom.y*a.cueBallSpotZoom.y>16900){var e=Math.atan2(a.cueBallSpotZoom.y,a.cueBallSpotZoom.x);a.cueBallSpotZoom.x=130*Math.cos(e),a.cueBallSpotZoom.y=130*Math.sin(e)}a.cueBallSpot.x=50*a.cueBallSpotZoom.x/130,a.cueBallSpot.y=50*a.cueBallSpotZoom.y/130,a.ballArray[0].screw=Maths.fixNumber(.5*a.cueBallSpot.y/100),a.ballArray[0].english=Maths.fixNumber(a.cueBallSpot.x/100),a.cue.y=.8*a.ballArray[0].english*a.ballRadius*a.physScale}}(),function(){if(0==projectInfo.tutorial&&0==a.preventAim&&0==a.settingPower){if(!game.device.touch){var e=a.cursorLocal.x-a.ballArray[0].position.x*a.physScale,t=a.cursorLocal.y-a.ballArray[0].position.y*a.physScale;a.cueCanvas.angle=180/Math.PI*Math.atan2(t,e);var i=a.ballArray[0].position.x*a.physScale*.02,n=a.ballArray[0].position.y*a.physScale*-.02+Math.sin(Math.PI/180*a.cueCanvas.angle)*i;n>5&&(n=5),n<-5&&(n=-5),a.cueShadow.angle=3+n;var r=Math.cos(a.cueCanvas.angle*Math.PI/180),l=Math.sin(a.cueCanvas.angle*Math.PI/180);a.aimDirectionVector=new Vector2D(r,l).normalize(),o()}if(game.device.touch)if(1==game.input.activePointer.isDown)if(a.startAim){var s=game.input,p=new Point(s.x-a.gameCanvas.x,s.y-a.gameCanvas.y);a.landscape||(p=new Point(-p.y,p.x));var c=180/Math.PI*Math.atan2(p.y/a.physScale-a.ballArray[0].position.y,p.x/a.physScale-a.ballArray[0].position.x),u=Maths.angleDiff(Maths.wrapValue(c),Maths.wrapValue(a.startAng));u*=a.aimSensitivity,a.cueCanvas.angle=a.startCue+u;r=Math.cos(a.cueCanvas.angle*Math.PI/180),l=Math.sin(a.cueCanvas.angle*Math.PI/180);a.aimDirectionVector=new Vector2D(r,l).normalize(),o(),(u>10||u<-10)&&(a.startCue=Maths.wrapValue(a.cueCanvas.angle),a.startAng=180/Math.PI*Math.atan2(a.cursorLocal.y/a.physScale-a.ballArray[0].position.y,a.cursorLocal.x/a.physScale-a.ballArray[0].position.x),a.aimSensitivity+=.1,a.aimSensitivity>1&&(a.aimSensitivity=1))}else a.cursorLocal.x<a.tableTop.width/2&&a.cursorLocal.x>-a.tableTop.width/2&&a.cursorLocal.y<a.tableTop.height/2&&a.cursorLocal.y>-a.tableTop.height/2&&(a.preventSetPower=!0,a.startCue=Maths.wrapValue(a.cueCanvas.angle),a.startAng=180/Math.PI*Math.atan2(a.cursorLocal.y/a.physScale-a.ballArray[0].position.y,a.cursorLocal.x/a.physScale-a.ballArray[0].position.x),a.startAim=!0,a.aimSensitivity=.5,a.firstTouch||(a.startCue=a.cueCanvas.angle,a.firstTouch=!0));else a.startAim=!1,a.preventSetPower=!1}}(),function(){if(0==projectInfo.tutorial&&0==a.preventSetPower){if(!game.device.touch&&(1==game.input.activePointer.isDown&&0==a.settingPower&&0==a.beginStrike&&a.cursorLocal.x<a.tableTop.width/2&&a.cursorLocal.x>-a.tableTop.width/2&&a.cursorLocal.y<a.tableTop.height/2&&a.cursorLocal.y>-a.tableTop.height/2&&(a.settingPower=!0,a.mouseX=game.input.x,a.mouseY=game.input.y),1==game.input.activePointer.isDown&&1==a.settingPower&&0==a.beginStrike)){var e=game.input.x-a.mouseX,t=game.input.y-a.mouseY,i=180,n=new Vector2D(-e,-t);a.landscape||(n=new Vector2D(t,-e)),(r=n.dot(a.aimDirectionVector))>i&&(r=i),r<0&&(r=0),a.power=a.maxPower*(Math.pow(r,1.4)/Math.pow(i,1.4)),o(),a.cue.x=-.5*r-1.5*a.ballRadius*a.physScale,a.cueShadow.x=a.cue.x}var r;if(game.device.touch)if(1==game.input.activePointer.isDown&&0==a.settingPower&&0==a.beginStrike&&(a.landscape&&game.input.x<140||!a.landscape&&game.input.x<120)&&(a.settingPower=!0,a.mouseX=game.input.x,a.mouseY=game.input.y),1==game.input.activePointer.isDown&&1==a.settingPower&&0==a.beginStrike)(r=(a.landscape,game.input.y-a.mouseY))>(i=500)&&(r=i),r<0&&(r=0),a.power=a.maxPower*(Math.pow(r,1.4)/Math.pow(i,1.4)),a.landscape,a.powerBarMask.y=r,a.powerBarCue.x=a.powerBarBase.x+250-.9*r,o(),a.cue.x=-.3*r-1.5*a.ballRadius*a.physScale,a.cueShadow.x=a.cue.x;a.power<40&&0==game.input.activePointer.isDown&&1==a.settingPower&&(a.settingPower=!1)}}(),function(){if(a.power>40&&0==game.input.activePointer.isDown&&1==a.settingPower&&0==a.beginStrike){a.beginStrike=!0,function(){for(var e=1;e<a.ballArray.length;e++){a.ballArray[e].marker.visible=!1}}();var e=1/a.power;e>.8&&(e=.8),e<.1&&(e=.1);var t=game.add.tween(a.cue);t.to({x:a.power/400},1e3*e,Phaser.Easing.Linear.Out);var i=game.add.tween(a.cueShadow);i.to({x:a.power/400},1e3*e,Phaser.Easing.Linear.Out);var n=game.add.tween(a.cueCanvas);if(n.to({alpha:0},1e3,Phaser.Easing.Linear.None,1500),n.onComplete.add(l,this),game.device.touch){var o=game.add.tween(a.powerBarCue);o.to({x:250},1e3*e,Phaser.Easing.Linear.Out),o.start()}function l(){a.cueCanvas.visible=!1,a.cueCanvas.alpha=1,a.cueTweenComplete=!0}t.start(),i.start(),n.start(),a.guideCanvas.visible=!1,a.cueBallInHand=!1}1==a.beginStrike&&a.cue.x>=-a.ballRadius*a.physScale&&r()}())),"p2"==a.turn&&1==projectInfo.mode&&(function(){if(0==a.shotNum&&0==a.shotRunning){var e;a.ballArray[0].position.x=-15e3*a.adjustmentScale,e=Math.random()>.5?1:-1,a.ballArray[0].position.y=Math.random()*(15e3*a.adjustmentScale-a.ballRadius)*e,a.cueCanvas.x=a.gameCanvas.x+a.ballArray[0].position.x*a.physScale,a.cueCanvas.y=a.gameCanvas.y+a.ballArray[0].position.y*a.physScale,renderScreen()}if(a.shotNum>0&&0==a.shotRunning&&1==a.cueBallInHand){var t=a.ballArray[0];a.shotNum>0&&0==t.mc.visible&&(t.mc.visible=!0,t.shadow.visible=!0,t.active=!0);for(var i=new Array,n=1;n<a.ballArray.length;n++){var o=a.ballArray[n];1==o.active&&(o.targetType==a.p2TargetType||"ANY"==a.p2TargetType&&"8 BALL"!=o.targetType)&&i.push(o)}for(var r=new Array,l=0;l<i.length;l++)for(var s=i[l],p=0;p<6;p++){var c=a.pocketArray[p];if(1==f(s,c)){var u=new Object;u.ball=o,u.pocket=c,r.push(u)}}var d=!1;if(r.length>0)for(var y=0;y<r.length;y++){var m=r[y].ball,h=r[y].pocket,v=new Vector2D(h.position,m.position).normalize(),b=m.position.plus(v.times(4e3));if(b.x>-3e4*a.adjustmentScale+a.ballRadius&&b.x<3e4*a.adjustmentScale-a.ballRadius&&b.y>-15e3*a.adjustmentScale+a.ballRadius&&b.y<15e3*a.adjustmentScale-a.ballRadius){var S=new Object;if(S.position=b,1==f(S,m)&&0==g(b.x,b.y)){d=!0,a.cueBallInHand=!1,a.ballArray[0].position.x=b.x,a.ballArray[0].position.y=b.y,renderScreen();break}}}if(0==d){var w=0;do{w++;var x=5e4*Math.random()-25e3,P=2e4*Math.random()-1e4;if(0==g(x,P)){d=!0,a.cueBallInHand=!1,a.ballArray[0].position.x=x,a.ballArray[0].position.y=P,renderScreen();break}}while(w<500&&0==d)}0==d&&(a.cueBallInHand=!1,a.ballArray[0].position.x=0,a.ballArray[0].position.y=0),a.cueCanvas.x=a.gameCanvas.x+a.ballArray[0].position.x*a.physScale,a.cueCanvas.y=a.gameCanvas.y+a.ballArray[0].position.y*a.physScale}}(),function(){if(0==a.foundCalculatedShots&&(a.foundCalculatedShots=!0,a.shotInfo=new Object,a.shotNum>0)){a.trial=!0,a.shotRating=0,a.testNumber=0,a.storeBallArray=new Array;for(var e=0;e<a.ballArray.length;e++){var t=a.ballArray[e],i=new Object;i.position=t.position,i.active=t.active,a.storeBallArray.push(i)}a.bestShot=-2;var n=function(){for(var e=new Array,t=1;t<a.ballArray.length;t++){var i,n=a.ballArray[t];if(1==n.active)if(i="p2"==a.turn?a.p2TargetType:a.p1TargetType,n.targetType==i||"ANY"==i&&"8 BALL"!=n.targetType)for(var o=0;o<6;o++){var r=a.pocketArray[o],l=new Vector2D(r.position.x-n.position.x,r.position.y-n.position.y).normalize().times(2.01*-a.ballRadius),s=new Object;s.position=n.position.plus(l),s.ball=n,s.pocket=r,e.push(s)}}e.length;return e}();a.shotTrialArray=new Array;for(var o=0;o<n.length;o++){var r=n[o];if(1==f(a.ballArray[0],r)&&1==f(r.ball,r.pocket)){var l=500+1500*Math.random(),s=new Vector2D(r.position.x-a.ballArray[0].position.x,r.position.y-a.ballArray[0].position.y).normalize().times(l);a.shotTrialArray.push(s)}}if(0==a.shotTrialArray.length)for(o=0;o<n.length;o++){if(1==f((r=n[o]).ball,r.pocket))for(var p=0;p<3;p++){var c,u,d=new Point(a.ballArray[0].position.x,a.ballArray[0].position.y),y=new Point(r.position.x,r.position.y),m=3e4*a.adjustmentScale-a.ballRadius,h=15e3*a.adjustmentScale-a.ballRadius;switch(p){case 0:c=new Point(2*m-y.x,y.y),u=new Point(2*m-d.x,d.y);break;case 1:c=new Point(-2*m-y.x,y.y),u=new Point(-2*m-d.x,d.y);break;case 2:c=new Point(y.x,2*h-y.y),u=new Point(d.x,2*h-d.y);break;case 3:c=new Point(y.x,-2*h-y.y),u=new Point(d.x,-2*h-d.y);break}if(1==S(d,c)&&1==S(u,y)){l=500+1500*Math.random(),s=new Vector2D(c.x-d.x,c.y-d.y).normalize().times(l);a.shotTrialArray.push(s),a.shotInfo.bankShot=!0}}}a.shotInfo.bankShot,0==a.shotTrialArray.length?(a.shotInfo.calculated=!1,w()):a.shotInfo.calculated=!0}}(),function(){if(1==a.trial&&a.testNumber<a.shotTrialArray.length){a.shotRating=0;var e=a.shotTrialArray[a.testNumber];x(e.x,e.y,0,0);do{a.phys.updatePhysics(),l()}while(1==a.shotRunning);s(),a.shotRating>a.bestShot&&(a.bestShot=a.shotRating,a.shotInfo.aimVector=e),function(e){for(var t=0;t<a.ballArray.length;t++){var i=a.ballArray[t];i.position=e[t].position,i.active=e[t].active}}(a.storeBallArray),a.testNumber++,a.shotInfo.calculated&&a.testNumber>=a.shotTrialArray.length&&a.bestShot<=0&&(a.shotInfo.calculated=!1,w()),(a.testNumber>=a.shotTrialArray.length||1==a.shotRating)&&function(){a.trial=!1;var e=0;e=5*Math.random()>projectInfo.aiRating?20*Math.random()*(5-projectInfo.aiRating):0;a.shotInfo.aimVector=new Vector2D(a.shotInfo.aimVector.x+e,a.shotInfo.aimVector.y);var t=game.add.tween(a.cueCanvas);function i(){x(a.shotInfo.aimVector.x,a.shotInfo.aimVector.y,0,0)}t.to({angle:180/Math.PI*Math.atan2(a.shotInfo.aimVector.y,a.shotInfo.aimVector.x)},1e3,Phaser.Easing.Linear.easeInOut,!0),t.onComplete.add(i,this)}()}}(),function(){if(0==a.shotNum){a.shotReset=!1;var e=2*Math.random()-1+Maths.findBearing(a.ballArray[1].position.x-a.ballArray[0].position.x,a.ballArray[1].position.y-a.ballArray[0].position.y),t=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180),n=new Vector2D(t,i).normalize(),o=4e3+500*Math.random();a.shotInfo.aimVector=n.times(o),game.add.tween(a.cueCanvas).to({angle:180/Math.PI*Math.atan2(a.shotInfo.aimVector.y,a.shotInfo.aimVector.x)},1e3,Phaser.Easing.Linear.easeInOut,!0),game.time.events.add(2e3,x,this,a.shotInfo.aimVector.x,a.shotInfo.aimVector.y,0,0)}}()),n()),1==a.shotRunning&&(l(),0==projectInfo.tutorial&&s(),a.phys.updatePhysics(),renderScreen()),0==projectInfo.levelComplete&&(a.scoreText.text=projectInfo.score,1==projectInfo.mode&&"p1"==a.turn&&updateTimer()),a.debugText.text=game.time.fps,1==a.gameOver&&1==a.foulDisplayComplete&&(a.cueBaseCanvas.visible=!1,a.guideCanvas.visible=!1,a.gameRunning=!1,c()),function(){game.input.activePointer.isDown&&1==projectInfo.tutorial&&(a.cancelTutorial=!0,i());if(1==projectInfo.tutorial){var e;switch(a.turn="p1",projectInfo.tutorialPlayed=!0,e=game.device.touch?a.hand:a.mouseSprite,a.tutStage){case 0:window.famobi_analytics.trackScreen("SCREEN_TUTORIAL"),a.cancelTutorial=!1,a.skipText.visible=!0,a.tutorialText.visible=!0,e.x=120,e.y=-90;var n=e.x-a.ballArray[0].position.x*a.physScale,l=e.y-a.ballArray[0].position.y*a.physScale;a.cueCanvas.angle=180/Math.PI*Math.atan2(l,n);var s=game.add.tween(e);function p(){a.tutStage=2}s.to({alpha:1},700,Phaser.Easing.Linear.None,!0,700),s.onComplete.add(p,this),a.tutStage=1;break;case 2:if(0==a.cancelTutorial){var c=game.add.tween(e);function u(){a.tutStage=4}c.to({x:a.ballArray[1].position.x*a.physScale,y:(a.ballArray[1].position.y+1e3)*a.physScale},2500,Phaser.Easing.Quadratic.InOut,!0,0),c.onComplete.add(u,this),a.tutStage=3}else a.turn=t,i();break;case 3:if(0==a.cancelTutorial){n=e.x-a.ballArray[0].position.x*a.physScale,l=e.y-a.ballArray[0].position.y*a.physScale;a.cueCanvas.angle=180/Math.PI*Math.atan2(l,n);var d=a.ballArray[0].position.x*a.physScale*.02,y=a.ballArray[0].position.y*a.physScale*-.02+Math.sin(Math.PI/180*a.cueCanvas.angle)*d;y>5&&(y=5),y<-5&&(y=-5),a.cueShadow.angle=3+y;var m=Math.cos(a.cueCanvas.angle*Math.PI/180),h=Math.sin(a.cueCanvas.angle*Math.PI/180);a.aimDirectionVector=new Vector2D(m,h).normalize(),o()}else i();break;case 4:if(0==a.cancelTutorial)if(game.device.touch){var v=game.add.tween(e);function g(){a.tutStage=6}v.to({alpha:0},700,Phaser.Easing.Linear.none,!0,700),v.onComplete.add(g,this),a.tutStage=5}else a.tutStage=96;else i();break;case 5:break;case 6:if(0==a.cancelTutorial){a.landscape?(a.pointerStart=a.pointerStartL,a.pointerEnd=a.pointerEndL):(a.pointerStart=a.pointerStartP,a.pointerEnd=a.pointerEndP),e.x=a.pointerStart.x,e.y=a.pointerStart.y;var b=game.add.tween(e);function f(){a.tutStage=8}b.to({alpha:1},700,Phaser.Easing.Linear.none,!0,700),b.onComplete.add(f,this),a.tutStage=7}else i();break;case 7:break;case 8:0==a.cancelTutorial?(a.landscape?e.y=a.pointerStart.y+a.pointerProgress:e.x=a.pointerStart.x-a.pointerProgress,a.pointerProgress+=2,a.landscape?e.y>=a.pointerEnd.y&&(a.tutStage=9):e.x<=a.pointerEnd.x&&(a.tutStage=9),a.powerBarMask.y=a.pointerProgress,a.powerBarCue.x=250-.9*a.pointerProgress,a.cue.x=-.7*a.pointerProgress-1.5*a.ballRadius*a.physScale,a.cueShadow.x=a.cue.x):i();break;case 9:if(0==a.cancelTutorial){var S=game.add.tween(e);function w(){a.tutStage=11}S.to({alpha:0},200,Phaser.Easing.Linear.none,!0,700),S.onComplete.add(w,this),a.tutStage=10}else i();break;case 10:break;case 11:if(0==a.cancelTutorial){var x=100;game.device.touch?a.power=a.maxPower*(a.pointerProgress*a.pointerProgress/(x*x))/4:a.power=1600;var P=1/a.power;P>.8&&(P=.8),P<.1&&(P=.1);var A=game.add.tween(a.cue);A.to({x:a.power/400},1e3*P,Phaser.Easing.Linear.Out);var T=game.add.tween(a.cueCanvas);if(T.to({alpha:0},1e3,Phaser.Easing.Linear.None,700),T.onComplete.add(R,this),game.device.touch){var I=game.add.tween(a.powerBarCue);I.to({x:250},1e3*P,Phaser.Easing.Linear.Out),I.start()}function R(){a.cueCanvas.visible=!1,a.cueCanvas.alpha=1,a.cueTweenComplete=!0}A.start(),T.start(),a.guideCanvas.visible=!1,a.tutStage=12}else i();break;case 12:0==a.cancelTutorial?a.cue.x>=-a.ballRadius*a.physScale&&(r(),a.tutStage=13):i();break;case 13:var C=game.add.tween(a.guiCanvas).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,3e3);game.add.tween(a.guiBaseCanvas).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,3e3),game.add.tween(a.gameCanvas).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0,3e3);C.onComplete.add(i,this),a.tutStage=14;break;case 14:break;case 96:if(0==a.cancelTutorial){function k(){e.frame=1,a.tutStage=98}game.time.events.add(1.5*Phaser.Timer.SECOND,k,this),a.tutStage=97}else i();break;case 97:break;case 98:if(0==a.cancelTutorial){function L(){e.frame=2,a.tutStage=100}game.time.events.add(1.5*Phaser.Timer.SECOND,L,this),a.tutStage=99}else i();break;case 99:break;case 100:if(0==a.cancelTutorial){function M(){a.tutStage=102}game.add.tween(e).to({x:210,y:(a.ballArray[1].position.y+1e3)*a.physScale},1500,Phaser.Easing.Linear.Out,!0,0).onComplete.add(M,this),a.tutStage=101;game.add.tween(a.cue).to({x:-120},1500,Phaser.Easing.Linear.Out,!0,0);a.dottedLine=new Phaser.Sprite(game,0,0,"dottedLine"),a.dottedLine.anchor=new Point(1,.5),a.cueCanvas.addChildAt(a.dottedLine,1),a.dottedLine.x=-20}else i();break;case 101:a.cueShadow.x=a.cue.x;break;case 102:if(0==a.cancelTutorial){function j(){a.tutStage=104}game.time.events.add(2*Phaser.Timer.SECOND,j,this),a.tutStage=103}else i();break;case 103:break;case 104:0==a.cancelTutorial?(a.dottedLine.visible=!1,e.frame=0,a.tutStage=11):i();break}}}()),function(){1==a.allowTransferPoints&&(parseInt(a.gameOverPanel.text1.text)<projectInfo.score?(a.gameOverPanel.text1.text=String(parseInt(a.gameOverPanel.text1.text)+5),parseInt(a.gameOverPanel.text1.text)>projectInfo.score&&(a.gameOverPanel.text1.text=String(projectInfo.score)),parseInt(a.gameOverPanel.text2.text)<parseInt(a.gameOverPanel.text1.text)&&(a.gameOverPanel.text2.text=a.gameOverPanel.text1.text),Sound.Play("ding",.3)):(a.allowTransferPoints=!1,0==a.transfer1Complete&&(a.transfer1Complete=!0,game.time.events.add(1e3,d,this)),0==a.transfer2Complete&&(a.transfer2Complete=!0)))}(),1==a.popUpPanel.visible&&game.input.activePointer.isDown&&(1==a.landscape?(game.input.activePointer.x>a.popUpPanel.x+a.popUpPanelBG.width/2||game.input.activePointer.x<a.popUpPanel.x-a.popUpPanelBG.width/2||game.input.activePointer.y>a.popUpPanel.y+a.popUpPanelBG.height/2||game.input.activePointer.y<a.popUpPanel.y-a.popUpPanelBG.height/2)&&this.resumeGame():(game.input.activePointer.x>a.popUpPanel.x+a.popUpPanelBG.height/2||game.input.activePointer.x<a.popUpPanel.x-a.popUpPanelBG.height/2||game.input.activePointer.y>a.popUpPanel.y+a.popUpPanelBG.width/2||game.input.activePointer.y<a.popUpPanel.y-a.popUpPanelBG.width/2)&&this.resumeGame()),game.input.activePointer.isDown&&1==a.foulWindow.visible&&(a.foulWindow.visible=!1,a.foulDisplayComplete=!0,0==a.rerack&&(a.gameRunning=!0),p()),window.FORCE_LOSE=(e=!0)=>{c(e)}};