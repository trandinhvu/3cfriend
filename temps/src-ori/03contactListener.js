function onContact(e){var t,o=playState.gameInfo,a=e,l=a.ball,i=new Object;(i.position=l.position,i.targetPosition=a.target.position,i.velocity=a.ballVelocity,i.collisionType=a.collisionType,i.screw=l.screw,"ball"==a.collisionType&&(i.target=a.target,i.targetVelocity=a.targetVelocity,i.deltaScrew=a.deltaScrew),i.type=a.collisionType,"ball"==a.collisionType)&&(l.contactArray.push(i),0==o.trial&&((t=i.velocity.minus(i.targetVelocity).magnitude/6e3)>1&&(t=1),Sound.Play("ballHit",t)));"line"!=a.collisionType&&"vertex"!=a.collisionType||(l.contactArray.push(i),0==o.trial&&((t=a.normalVelocity.magnitude/3e3)>2&&(t=2),Sound.Play("cushionHit",t)));"pocket"==a.collisionType&&(l.active=!1,l.velocity=new Vector2D(0,0),l.contactArray.push(i),0==o.trial&&(playPocketSound(a),playPocketAnimation(a),projectInfo.tutorial||awardBonuses(a)),0==l.id?o.scratched=!0:o.ballsRemaining--)}function playPocketSound(e){var t=e.speed/5e3;t>1.5&&(t=1.5),t<.3&&(t=.3),Sound.Play("pocketHit",t)}function awardBonuses(e){var t=playState.gameInfo;if(0!=e.ball.id){var o=e.target;t.numBalls--,t.pottedBallArray.push(e.ball.id),checkLevelComplete(),t.ballPotted=!0,1==projectInfo.mode&&"p1"==t.turn&&(createBonusText(0,String(10*t.multiplier),"font6",o.dropPosition.x*t.physScale,o.dropPosition.y*t.physScale,56,!1),game.time.events.add(1.5*Phaser.Timer.SECOND,(function(){if(projectInfo.score+=10*t.multiplier,projectInfo.score>t.bestScore){t.bestScore=projectInfo.score;try{window.famobi.localStorage.setItem("bestScore",t.bestScore)}catch(e){}}t.multiplier++,t.multiplierText.text="x"+t.multiplier;var e=game.add.tween(t.multiplierText);e.from({size:42},2e3),e.start()}),this))}else t.fouled=!0}function checkLevelComplete(){playState.gameInfo.numBalls<=1&&(projectInfo.levelComplete=!0)}function playPocketAnimation(e){var t=playState.gameInfo;if(0==t.trial){var o=e.ball,a=e.target,l=e.speed;o.pocketTweenComplete=!1,0!=o.id?(o.shadow.parent.removeChild(o.shadow),o.shadow=null):o.shadow.visible=!1;var i=.1;l<5e3&&(i=.2),l<3e3&&(i=.3),l<2e3&&(i=.4),l<1e3&&(i=.5),i*=300;var n=game.add.tween(o.mc);n.to({x:a.dropPosition.x*t.physScale,y:a.dropPosition.y*t.physScale},i),n.onComplete.add((function(){var e=o.mc.x,a=o.mc.y;t.ballCanvas.removeChild(o.mc),t.tunnelCanvas.addChild(o.mc),o.mc.x=e,o.mc.y=a,c.start()}),this),n.start();var c=game.add.tween(o.mc);c.to({x:.7*a.dropPosition.x*t.physScale,y:.7*a.dropPosition.y*t.physScale},1.2*i,Phaser.Easing.Linear.In),0!=o.id?c.onComplete.add((function(){!function(e){0!=e.id&&(t.tunnelCanvas.removeChild(e.mc),e.pocketTweenComplete=!0)}(o)}),this):c.onComplete.add((function(){t.tunnelCanvas.removeChild(o.mc),t.ballCanvas.addChild(o.mc),o.pocketTweenComplete=!0,o.mc.visible=!1}),this)}}