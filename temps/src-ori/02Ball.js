var Ball=function(t,s){var h;this.ballRotation=new Array(1,0,0,0),this.rX=0,this.rY=0,this.rZ=0,this.circRad=0,this.ballCanvas,this.ball,this.canvas,this.spot,this.spotHolder,this._mask,this.shading,this.highlightCanvas,this.highlight,this.ballColor,this.ballType,this.circRad=t,s<=8?(this.ballType=0,h="solidsSpriteSheet"):(this.ballType=1,h="ballSpriteSheet"+String(s)),Phaser.Group.call(this,game,this,"ball"),this.sprite=new Phaser.Sprite(game,0,0,h),this.sprite.width=2*this.circRad,this.sprite.height=2*this.circRad,this.sprite.anchor=new Phaser.Point(.5,.5),this.addChild(this.sprite),1==this.ballType||(this.sprite.frame=s),this.spotHolder=new Phaser.Group(game,this,"spotHolder"),this.spot=new Phaser.Sprite(game,0,0,"spotSpriteSheet"),this.spot.anchor=new Phaser.Point(.5,.5),this.spotHolder.addChild(this.spot),this.spot.frame=s,this.spot.alpha=1,this.shade=new Phaser.Sprite(game,0,0,"shade"),this.addChild(this.shade),this.shade.anchor=new Point(.5,.5),this.shade.width=2.1*t,this.shade.height=2.1*t,this.updateRotation(10*Math.random()-5,10*Math.random()-5,10*Math.random()-5)};Ball.prototype=Object.create(Phaser.Group.prototype),Ball.prototype.constructor=Ball,Ball.prototype.updateRotation=function(t,s,h){var i=-t,a=h,o=s,r=Math.sqrt(i*i+a*a+o*o);r>.01&&(this.ballRotation=this.rotateQuat(this.ballRotation,a/r,i/r,o/r,r/this.circRad),this.ballRotation=this.normalize(this.ballRotation),this.renderBall(this.ballRotation))},Ball.prototype.renderBall=function(t){var s=t[0],h=t[1],i=t[2],a=t[3],o=Math.atan2(2*s*a-2*h*i,1-2*s*s-2*i*i)+Math.PI,r=Math.asin(2*h*s+2*i*a)+Math.PI,e=Math.atan2(2*h*a-2*s*i,1-2*h*h-2*i*i)+Math.PI,l=h*s+i*a;if(!(l>.499||l<-.499)){if(this.angle=180/Math.PI*o,this.shade.angle=-this.angle,1==this.ballType){var p=(r-.5*Math.PI)/Math.PI;this.sprite.frame=41-Math.round(41*p)}this.spotHolder.x=0,this.spotHolder.y=0,this.spotHolder.angle=0,this.spot.x=0,this.spot.y=0,this.spot.angle=0,this.spot.width=1*this.circRad,this.spot.height=1*this.circRad,r<Math.PI/2||r>3*Math.PI/2?e>Math.PI/2&&e<3*Math.PI/2?(this.spotHolder.y=this.circRad*Math.cos(e)*Math.sin(r),this.spotHolder.x=this.circRad*Math.sin(e)):(this.spotHolder.y=-this.circRad*Math.cos(e)*Math.sin(r),this.spotHolder.x=-this.circRad*Math.sin(e)):e>Math.PI/2&&e<3*Math.PI/2?(this.spotHolder.y=-this.circRad*Math.cos(e)*Math.sin(r),this.spotHolder.x=-this.circRad*Math.sin(e)):(this.spotHolder.y=this.circRad*Math.cos(e)*Math.sin(r),this.spotHolder.x=this.circRad*Math.sin(e));var n=Math.sqrt(this.spotHolder.x*this.spotHolder.x+this.spotHolder.y*this.spotHolder.y)/this.circRad,d=Math.cos(n*Math.PI/2),c=Math.atan2(this.spotHolder.y,this.spotHolder.x);this.spotHolder.scale=new Point(1,d),this.spotHolder.angle=180/Math.PI*c+90,this.spot.angle=-this.spotHolder.angle,this.spot.alpha=d+.2}},Ball.prototype.rotateQuat=function(t,s,h,i,a){var o=Math.sqrt(s*s+h*h+i*i),r=s/o,e=h/o,l=i/o,p=Math.sin(.5*a),n=r*p,d=e*p,c=l*p,M=Math.cos(.5*a),P=t[0],y=t[1],H=t[2],R=t[3],g=P*M+y*c-H*d+R*n,b=-P*c+y*M+H*n+R*d,u=P*d-y*n+H*M+R*c,m=-P*n-y*d-H*c+R*M,w=new Array;return w[0]=g,w[1]=b,w[2]=u,w[3]=m,w},Ball.prototype.normalize=function(t){var s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]),h=new Array;return h[0]=t[0]/s,h[1]=t[1]/s,h[2]=t[2]/s,h[3]=t[3]/s,h};